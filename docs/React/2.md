# 3:React æ€§èƒ½ä¼˜åŒ–

è¦æƒ³äº†è§£ `React` éƒ½å¯ä»¥è¿›è¡Œå“ªäº›æ€§èƒ½çš„ä¼˜åŒ–ä¹‹å‰æˆ‘ä»¬å¿…é¡»è¦å…ˆæŒæ¡ `React` çš„æ¸²æŸ“å’Œæ›´æ–°æœºåˆ¶æ˜¯å¦‚ä½•çš„

## React æ¸²æŸ“å’Œæ›´æ–°æœºåˆ¶

åœ¨[1:JSX çš„æœ¬è´¨-æ€»ç»“](./#æ€»ç»“)ä¸­æˆ‘ä»¬å·²ç»äº†è§£äº† React æ˜¯å¦‚ä½•ä»ç¼–å†™ JSX ä»£ç åˆ°æ¸²æŸ“çš„,é‚£ä¹ˆ React çš„æ›´æ–°æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„å‘¢?<br/>
æˆ‘ä»¬å¯ä»¥ç»“åˆ React å®˜ç½‘ç»™å‡ºçš„ç”Ÿå‘½å‘¨æœŸå›¾æ¥å‚è€ƒä¸€ä¸‹<br/>
![xxx](../images/React/2/0.png)<br/>
ä¸éš¾çœ‹å‡ºåœ¨ `Updating` æ¨¡å—ä¸­åªè¦ `props` å’Œ `state` å‘ç”Ÿæ”¹å˜å°±ä¼šè§¦å‘ `render` å‡½æ•°, åœ¨ `render` å‡½æ•°ä¸­ `React` ä¼šæŠŠæ–°åˆ›å»ºå‡ºæ¥çš„ `è™šæ‹ŸDOM` å’Œ ä¹‹å‰çš„ `DOM` è¿›è¡Œå¯¹æ¯”å¹¶è®¡ç®—å‡ºæœ€åè¦è½¬æ¢æˆçš„ `DOMå¯¹è±¡æ ‘`,æœ€ç»ˆè½¬åŒ–æˆ `çœŸå®DOM` å¹¶æ¸²æŸ“åˆ°é¡µé¢ä¸Š<br/>
ä½†å¯¹æ¯”ä¸¤ä¸ªæ ‘å¹¶ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹, React å®˜ç½‘ä¸­ä¹Ÿæåˆ°äº†:
::: tip
å³ä½¿åœ¨æœ€å‰æ²¿çš„ç®—æ³•ä¸­ï¼Œè¯¥ç®—æ³•çš„å¤æ‚ç¨‹åº¦ä¸º O(n^3)ï¼Œå…¶ä¸­ n æ˜¯æ ‘ä¸­å…ƒç´ çš„æ•°é‡ã€‚
:::
è€Œ React åœ¨ä¸¤æ£µæ ‘çš„å¯¹æ¯”ä¸Šæå‡ºäº†ä¸€å¥—å¤æ‚åº¦ä¸º O(n) çš„ç®—æ³•--->Diffing

## Diffing

å…³äº React çš„ Diffing ç®—æ³•, React å®˜ç½‘ä¹Ÿç»™å‡ºäº†ç›¸åº”çš„è®²è§£,åœ¨è¿™é‡Œå¯ä»¥æ€»ç»“ä¸ºä»¥ä¸‹å‡ ç‚¹

### 1:æ¯”è¾ƒæ ¹èŠ‚ç‚¹

**å¯¹æ¯”ä¸¤æ£µæ ‘åŒä¸€çº§å…ƒç´ çš„æ ¹èŠ‚ç‚¹,æ ¹èŠ‚ç‚¹ä¸åŒ,ç›´æ¥åˆ æ‰é‡å»º,ä¸å†æ·±åº¦æ¯”è¾ƒ**
ä¸¾ä¸ªæ —å­

```js
// æ—§çš„è™šæ‹ŸDOMæ ‘
<div>
  <Counter />
</div>
// æ–°çš„è™šæ‹ŸDOMæ ‘
<span>
  <Counter />
</span>
```

å½“åˆ¤æ–­åˆ°ä¸Šé¢çš„æ ¹èŠ‚ç‚¹ `<div></div>` å’Œ `<span></span>` æ—¶,å› ä¸ºæ ¹èŠ‚ç‚¹ä¸ç›¸åŒ, æ‰€ä»¥ç›´æ¥åˆ é™¤æ—§æ ‘é‡å»ºæ–°æ ‘<br/>
**å¯¹æ¯”ä¸¤ä¸ªç›¸åŒç±»å‹çš„ React å…ƒç´ æ—¶ï¼ŒReact ä¼šä¿ç•™ DOM èŠ‚ç‚¹ï¼Œä»…æ¯”å¯¹åŠæ›´æ–°æœ‰æ”¹å˜çš„å±æ€§ã€‚**

```js
<div className="before" title="stuff" />
<div className="after" title="stuff" />
```

é€šè¿‡å¯¹æ¯”è¿™ä¸¤ä¸ªå…ƒç´ ï¼Œ`React` çŸ¥é“åªéœ€è¦ä¿®æ”¹ `DOM` å…ƒç´ ä¸Šçš„ `className` å±æ€§ã€‚<br/>
å½“æ›´æ–° style å±æ€§æ—¶ï¼ŒReact ä»…æ›´æ–°æœ‰æ‰€æ›´å˜çš„å±æ€§ã€‚æ¯”å¦‚:

```js
<div style={{color: 'red', fontWeight: 'bold'}} />
<div style={{color: 'green', fontWeight: 'bold'}} />
```

é€šè¿‡å¯¹æ¯”è¿™ä¸¤ä¸ªå…ƒç´ ï¼Œ`React`çŸ¥é“åªéœ€è¦ä¿®æ”¹ `DOM` å…ƒç´ ä¸Šçš„ `color` æ ·å¼ï¼Œæ— éœ€ä¿®æ”¹ `fontWeightã€‚`

### 2:é€’å½’æ¯”è¾ƒå­èŠ‚ç‚¹

æ¯”è¾ƒå®Œæ ¹èŠ‚ç‚¹ä¹‹å, React å°±ä¼šé€’å½’çš„æ¯”è¾ƒå­èŠ‚ç‚¹,ä¹Ÿå°±æ˜¯ä¸‹é¢çš„ä»£ç 

```js
<ul>
  <li>first</li>
  <li>second</li>
</ul>
```

æ”¹å˜ä¸º

```js
<ul>
  <li>first</li>
  <li>second</li>
  <li>third</li>
</ul>
```

React ä¼šæŒ‰ç…§é¡ºåºé€’å½’çš„æ¯”è¾ƒ `<li>first</li>` ä¸ `<li>first</li>`, `<li>second</li>` ä¸ `<li>second</li>`æœ€åå‘ç°åªæ–°å¢äº†ä¸€ä¸ª `<li>third</li>`,æ‰€ä»¥æœ€åä¼šä¿ç•™`<li>first</li>`å’Œ`<li>second</li>`, æ’å…¥æ–°å¢çš„`<li>third</li>`æ ‘,è¿™æ ·æ€§èƒ½ä¸Šä¸ä¼šæœ‰å¾ˆå¤§çš„æŸè€—,å¦‚æœä½ å°†`<li>third</li>`æ’å…¥åˆ°è¡¨å¤´çš„è¯:

```js
<ul>
  <li>first</li>
  <li>second</li>
</ul>
```

æ”¹å˜ä¸º

```js
<ul>
  <li>third</li>
  <li>first</li>
  <li>second</li>
</ul>
```

React ä¾æ—§ä¼šé»˜è®¤çš„å¯¹å­èŠ‚ç‚¹è¿›è¡Œé€’å½’çš„æ¯”è¾ƒ, ä¹Ÿå°±æ˜¯ `<li>first</li>` ä¸ `<li>third</li>` `<li>second</li>`ä¸ `<li>first</li>`å› ä¸ºä¸¤ä¸ªèŠ‚ç‚¹çš„å­å…ƒç´ å¹¶ä¸ç›¸åŒ,æ‰€ä»¥ä¼šé‡å»ºæ¯ä¸€ä¸ªå­å…ƒç´ , è¿™æ ·ä¼šäº§ç”Ÿæ€§èƒ½ä¸Šçš„é—®é¢˜,æ‰€ä»¥æ¥ä¸‹æ¥ [æ€§èƒ½ä¼˜åŒ–-Keys](#æ€§èƒ½ä¼˜åŒ–-keys) å°±ç™»åœºäº†

## æ€§èƒ½ä¼˜åŒ–-keys

ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜, `React` æ¨èæˆ‘ä»¬ä½¿ç”¨ `key` å±æ€§, å½“ä¸€ä¸ªå…ƒç´ æœ‰ `key` å±æ€§ä¹‹å, `React` ä¼šä½¿ç”¨ `key` æ¥åŒ¹é…åŸæ ‘å’Œæ–°æ ‘çš„å­å…ƒç´ , å¦‚ä¸‹ä»£ç 

```js
<ul>
  <li key="1">first</li>
  <li key="2">second</li>
</ul>
```

è½¬æ¢ä¸º

```js
<ul>
  <li key="3">third</li>
  <li key="1">first</li>
  <li key="2">second</li>
</ul>
```

å› ä¸º React ä¼šæ ¹æ® key è¿›è¡ŒåŒ¹é…ç„¶åè¿›è¡Œæ¯”è¾ƒ,å‘ç°åªæœ‰`<li key="3">third</li>`æ˜¯æ–°å…ƒç´ ,æ‰€ä»¥åªæ˜¯æ’å…¥ä¸€ä¸‹æ–°å…ƒç´ ç„¶åæ”¹å˜ä¸€ä¸‹
`<li key="1">first</li>` å’Œ `<li key="2">second</li>`çš„ä½ç½®å³å¯,è¿™æ ·åœ¨æ€§èƒ½ä¸Šå°±æœ‰äº†å¾ˆå¤§çš„æå‡<br/>
**key çš„æ³¨æ„äº‹é¡¹**
:::tip
key åº”è¯¥æ˜¯å”¯ä¸€çš„<br/>
key ä¸è¦ä½¿ç”¨éšæœºæ•°ï¼ˆéšæœºæ•°åœ¨ä¸‹ä¸€æ¬¡ render æ—¶ï¼Œä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ªæ•°å­—)<br/>
ä½¿ç”¨ index ä½œä¸º keyï¼Œå¯¹æ€§èƒ½æ˜¯æ²¡æœ‰ä¼˜åŒ–çš„<br/>
:::

## æ€§èƒ½ä¼˜åŒ–-shouldComponentUpdate

åœ¨ä½¿ç”¨ shouldComponentUpdate ä¹‹å‰æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ä¸‹é¢çš„ä»£ç 

```js
import React, { Component } from "react";
// Header
function Header() {
  console.log("Header renderå‡½æ•°è¢«è°ƒç”¨");
  return <h2>æˆ‘æ˜¯Headerç»„ä»¶</h2>;
}
// Main
class Main extends Component {
  render() {
    console.log("Main renderå‡½æ•°è¢«è°ƒç”¨");
    return (
      <div>
        <Banner />
        <ProductList />
      </div>
    );
  }
}
// Footer
function Footer() {
  console.log("Footer renderå‡½æ•°è¢«è°ƒç”¨");
  return <h2>æˆ‘æ˜¯Footerç»„ä»¶</h2>;
}

export default class App extends Component {
  constructor(props) {
    super(props);
    this.state = {
      counter: 0,
    };
  }
  render() {
    console.log("App renderå‡½æ•°è¢«è°ƒç”¨");
    return (
      <div>
        <h2>å½“å‰è®¡æ•°: {this.state.counter}</h2>
        <button onClick={(e) => this.increment()}>+1</button>
        <Header />
        <Main />
        <Footer />
      </div>
    );
  }
  increment() {
    this.setState({
      counter: this.state.counter + 1,
    });
  }
}
```

ä»£ç ç»“æ„å¾ˆæ¸…æ™°,å¦‚å›¾<br/>
<br/>
![xxx](../images/React/2/1.svg)<br/>
å½“ App ç¬¬ä¸€æ¬¡åŠ è½½æ—¶ï¼Œæµè§ˆå™¨ä¼šæ‰“å°å‡º

```js
App renderå‡½æ•°è¢«è°ƒç”¨
Headerè¢«è°ƒç”¨
Main renderå‡½æ•°è¢«è°ƒç”¨
Footer renderå‡½æ•°è¢«è°ƒç”¨
```

ä¸Šé¢çš„ç»“æœåº”è¯¥æ˜¯æˆ‘ä»¬é¢„æœŸçš„ç»“æœ,ç¬¬ä¸€æ¬¡æ‰“å¼€é¡µé¢æ—¶,åŠ è½½ App ç»„ä»¶ä»¥åŠå­ç»„ä»¶<br/>
æ¥ä¸‹æ¥æˆ‘ä»¬ç‚¹å‡» `<butoon>+1</button>`æŒ‰é’®å,æµè§ˆå™¨ä¾æ—§ä¼šæ‰“å°å‡º

```js
App renderå‡½æ•°è¢«è°ƒç”¨
Header renderå‡½æ•°è¢«è°ƒç”¨
Main renderå‡½æ•°è¢«è°ƒç”¨
Footer renderå‡½æ•°è¢«è°ƒç”¨
```

æˆ‘ä»¬å¯ä»¥èµ°ä¸€ä¸‹æµç¨‹, ç‚¹å‡»`<butoon>+1</button>`å, App ç»„ä»¶å†… state å‘ç”Ÿæ”¹å˜æ‰€ä»¥ä¼šæ‰“å°å‡º `App renderå‡½æ•°è¢«è°ƒç”¨`,éšå `Header` `Main` `Banner` ç»„ä»¶ä¹Ÿé‡æ–°åŠ è½½äº†,è¿™æ˜¯å› ä¸º `React` å†…éƒ¨**é»˜è®¤**(è¿™ä¸ªé»˜è®¤ä¸‹é¢ä¼šè®²åˆ°)æƒ…å†µä¸‹å½“çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶å­ç»„ä»¶ä¹Ÿè·Ÿç€ä¸€èµ·é‡æ–°æ¸²æŸ“<br/>
è¿™æ—¶å€™å°±å¼•èµ·äº†æˆ‘ä»¬çš„æ€è€ƒ,æˆ‘ä»¬åªæ˜¯æ”¹å˜äº† App ç»„ä»¶ä¸­çš„ state è€Œæ‰€æœ‰å­ç»„ä»¶ä¹Ÿä¸€èµ·é‡æ–°æ¸²æŸ“äº†,è¿™æ ·æ¥åšæµªè´¹äº†å¾ˆå¤šçš„æ€§èƒ½,é‚£ä¹ˆæœ‰ä»€ä¹ˆåŠæ³•å‘¢?<br/>
æˆ‘ä»¬å¯ä»¥å†çœ‹ä¸€ä¸‹ React å®˜æ–¹æ¯”è¾ƒè¯¦ç»†çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°, å¦‚å›¾:<br/>
![xxx](../images/React/2/2.png)<br/>
å¯ä»¥çœ‹å‡ºåœ¨ Updating æ¨¡å—ä¸­å¤šå‡ºäº† `shouldComponentUpadateUpdate` ç”Ÿå‘½å‘¨æœŸå‡½æ•°,è¿™ä¸ªå‡½æ•°åœ¨ `render` å‡½æ•°ä¹‹å‰,ä¹Ÿå°±æ˜¯æ‰€æˆ‘ä»¬å¯ä»¥æ ¹æ® `shouldComponentUpadateUpdate`çš„è¿”å›å€¼æ¥å†³å®šæ˜¯å¦æ‰§è¡Œ `render` å‡½æ•°,æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„ä»£ç :

```js
import React, { Component } from "react";

export default class App extends Component {
  constructor(props) {
    super(props);
    this.state = {
      counter: 0,
    };
  }
  render() {
    console.log("App renderå‡½æ•°è¢«è°ƒç”¨");
    return (
      <div>
        <h2>å½“å‰è®¡æ•°: {this.state.counter}</h2>
        <button onClick={(e) => this.increment()}>+1</button>
      </div>
    );
  }

  shouldComponentUpdate(nextProps, nextState) {
    return false;
  }
  increment() {
    this.setState({
      counter: this.state.counter + 1,
    });
  }
}
```

æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®,ç»“æœè®¡æ•°å¹¶æ²¡æœ‰å¢åŠ ,æ§åˆ¶å°ä¹Ÿæ²¡æ‰“å°å‡º `App renderå‡½æ•°è¢«è°ƒç”¨`,å¯ä»¥çœ‹å‡º `render` å‡½æ•°å·²ç»è¢«é˜»æ–­äº†,æœ‰äº†è¿™ä¸ªå‡½æ•°å°±å¯ä»¥åœ¨ç»„ä»¶çš„ `render` å‡½æ•°è°ƒç”¨å‰åˆ¤æ–­æ˜¯å¦è°ƒç”¨ `render` å‡½æ•°æ¥ç¡®å®šæ˜¯å¦é‡æ–°æ¸²æŸ“ç»„ä»¶äº†,å¦‚ä¸‹ä¾‹å­

```js
import React, { Component } from "react";
export default class App extends Component {
  constructor(props) {
    super(props);

    this.state = {
      counter: 0,
      message: "Hello World",
    };
  }
  render() {
    console.log("App renderå‡½æ•°è¢«è°ƒç”¨");
    return (
      <div>
        <h2>å½“å‰è®¡æ•°: {this.state.counter}</h2>
        <button onClick={(e) => this.increment()}>+1</button>
        <button onClick={(e) => this.changeText()}>æ”¹å˜æ–‡æœ¬</button>
      </div>
    );
  }
  increment() {
    this.setState({
      counter: this.state.counter + 1,
    });
  }
  changeText() {
    this.setState({
      message: "Hello React",
    });
  }
}
```

`App` ç»„ä»¶ä¸­ `state` æœ‰ `counter` å’Œ `message`ä½†æ­¤ç»„ä»¶å¹¶ä¸ä¾èµ–äº `message`<br/>æˆ‘ä»¬æœ‰ä»¥ä¸‹éœ€æ±‚:æ”¹å˜ `message` ä¸é‡æ–°æ¸²æŸ“ç»„ä»¶,åªæœ‰æ”¹å˜ `counter` çš„æ—¶å€™æ‰é‡æ–°æ¸²æŸ“ç»„ä»¶<br/>
å¯ä»¥åœ¨ App ä¸­å¢åŠ  ä»¥ä¸‹ä»£ç 

```js
 shouldComponentUpdate(nextProps, nextState) {
    //nextPropsä¸ºæ–°çš„props, nextStateä¸ºæ–°çš„state
    if (this.state.counter !== nextState.counter) {
      return true;
    }
    return false;
  }
```
è¿™æ ·æˆ‘ä»¬ç‚¹å‡»æ”¹å˜æ–‡æœ¬ç»„ä»¶å°±ä¸ä¼šé‡æ–°æ¸²æŸ“äº†<br/>
é‚£ä¹ˆ `shouldComponentUpadate` ä¸ºä»€ä¹ˆå°±ä¼šå†³å®šç»„ä»¶çš„æ›´æ–°ä¸å¦å‘¢? æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ `React` çš„æºç æ¥è¿›ä¸€æ­¥äº†è§£<br/>
åœ¨æºç çš„ `ReactFiberClassComponent.js`æ–‡ä»¶ä¸­ `checkShouldComponentUpdate`å‡½æ•°åˆ¤æ–­ç»„ä»¶æ›´æ–°ä¸å¦,å¦‚ä¸‹:
```js
function checkShouldComponentUpdate(
  workInProgress,
  ctor,
  oldProps,
  newProps,
  oldState,
  newState,
  nextContext,
) {
  const instance = workInProgress.stateNode;
  if (typeof instance.shouldComponentUpdate === 'function') {
    const shouldUpdate = instance.shouldComponentUpdate(
      newProps,
      newState,
      nextContext,
    );
    return shouldUpdate;
  }
  if (ctor.prototype && ctor.prototype.isPureReactComponent) {
    return (
      !shallowEqual(oldProps, newProps) || !shallowEqual(oldState, newState)
    );
  }
  return true;
}
```
è¿™ä¸ªå‡½æ•°é»˜è®¤è¿”å› `true`,ä¹Ÿå°±æ˜¯å‰é¢çš„é»˜è®¤æƒ…å†µä¸‹çˆ¶ç»„ä»¶æ›´æ–°å­ç»„ä»¶é‡æ–°æ¸²æŸ“çš„æƒ…å†µ,å¦‚æœè¯¥ç»„ä»¶ä¸­å­˜åœ¨ `shouldComponentUpdate`åˆ™è¿”å›å€¼ä¸º `shouldComponentUpdate` çš„è¿”å›å€¼<br/>
æœ‰äº† `shouldComponentUpadate` çš„åŸºç¡€æˆ‘ä»¬å°±å¯ä»¥ç†è§£ React çš„**ä¸å¯å˜æ•°æ®åŠ›é‡**äº†<br/>
åœ¨[2:setState](./1.html#ä¸å¯å˜å€¼-å‡½æ•°å¼ç¼–ç¨‹-çº¯å‡½æ•°)ä¸­æˆ‘ä»¬æåˆ°è¿‡**ä¸å¯å˜æ•°æ®çš„åŠ›é‡**æˆ‘ä»¬æ¥ç€ç”¨é‚£ä¸ªæ¡ˆä¾‹
```js
export default class APP extends Component {
    constructor(props) {
        super(props)
        this.state = {
            list: ['ğŸapple', 'ğŸŒbanana', 'ğŸ…tomato']
        }
    }
    render() {
        return (
            <div style={{margin: '200px auto', width: '200px'}}>
                {this.state.list.map((item) => {
                    return (
                        <h1 key={item}>{item}</h1>
                    )
                })}
                <button onClick={e => {this.addPotato()}}>ï¼‹ğŸ¥”</button>
            </div>
        );
    }
    addPotato() {
        this.state.list.push('ğŸ¥”potato')
        this.setState({
            list: this.state.list
        })
    }
}
```
ç‚¹å‡»æŒ‰é’®å¯ä»¥å®ç°å¯¹åˆ—è¡¨æ•°æ®çš„å¢åŠ ,ä½†æ˜¯æƒ³ç”¨ shouldComponent æ¥é‡æ„ä»¥ä¸‹ä»£ç æ¥å®ç°ä¸€äº›ç»„ä»¶çš„ä¸å¿…è¦æ¸²æŸ“,å¦‚ä¸‹
```js
export default class APP extends Component {
    constructor(props) {
        super(props)
        this.state = {
            list: ['ğŸapple', 'ğŸŒbanana', 'ğŸ…tomato']
        }
    }
    render() {
        return (
            <div style={{margin: '200px auto', width: '200px'}}>
                {this.state.list.map((item) => {
                    return (
                        <h1 key={item}>{item}</h1>
                    )
                })}
                <button onClick={e => {this.addPotato()}}>ï¼‹ğŸ¥”</button>
            </div>
        );
    }
    shouldComponentUpdate(nextProps, nextState) {
        if (this.state.list !== nextState.list) {
          return true;
        }
        return false;
    }
    addPotato() {
        this.state.list.push('ğŸ¥”potato')
        this.setState({
            list: this.state.list
        })
    }
}
```
æ‰§è¡Œä¸Šè¿°ä»£ç ,ç‚¹å‡»æŒ‰é’®,å‘ç°åˆ—è¡¨å¹¶æ²¡æœ‰é‡æ–°åˆ·æ–°,è¿™æ˜¯å› ä¸ºåœ¨ `setState` å‰å¯¹ `list` æ•°æ®è¿›è¡Œç›´æ¥çš„ä¿®æ”¹,è€Œåœ¨ `setState` ä¸­
`list` å’Œ `this.state.list` ç”¨çš„æ˜¯åŒä¸€ä¸ªå¼•ç”¨æ‰€ä»¥åœ¨ `shouldComponentUpadate` è¿”å› `false` ç»„ä»¶ä¸ä¼šé‡æ–°æ¸²æŸ“,æ¨¡æ‹Ÿå†…å­˜ç»“æ„å¦‚ä¸‹:<br/></br></br>
![xxx](../images/React/2/3.svg)<br/>
ä¿®æ”¹ `addPotato(){}` ä»£ç å
```js
    addPotato() {
        const newList = this.state.list.concat('ğŸ¥”potato')
        this.setState({
            list: newList
        })
    }
```
æ¨¡æ‹Ÿå†…å­˜ç»“æ„å¦‚ä¸‹<br/><br/><br/>
![xxx](../images/React/2/4.svg)<br/>

## æ€§èƒ½ä¼˜åŒ–-PureComponent å’Œ memo
ç†Ÿæ‚‰äº† `shouldComponentUpadateUpdate` ä¹‹å,è€ƒè™‘åˆ°æ€§èƒ½çš„ä¼˜åŒ–æˆ‘ä»¬è‚¯å®šä¼šä¼˜å…ˆè€ƒè™‘åœ¨ç»„ä»¶ä¸­ä½¿ç”¨å®ƒ,ä½†å­˜åœ¨ä»¥ä¸‹å‡ ç‚¹é—®é¢˜:<br/>
- å¦‚æœæ¯ä¸ªç»„ä»¶éƒ½å†™ä¸€ä¸ª `shouldComponentUpadateUpdate`ä¼šå‡ºç°éå¸¸å¤šçš„é‡å¤ä»£ç 
- å‡½æ•°å¼ç»„ä»¶å¹¶æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸ<br/>
ä¸ºäº†è§£å†³ä»¥ä¸Šé—®é¢˜ `PureComponent` `memo` å°±å¯ä»¥å®£å¸ƒç™»åœºäº†
**PureComponent**<br/>
ç±»ç»„ä»¶åªè¦ç»§æ‰¿ `PureComponent` é»˜è®¤åœ¨å‘ç”Ÿ `Updating` æ—¶å°±ä¼šå¯¹å†…éƒ¨æ•°æ®è¿›è¡Œæ¯”è¾ƒåˆ¤æ–­æ˜¯å¦é‡æ–°æ¸²æŸ“(ç›¸å½“äº `shouldComponentUpdate`)<br/>ä»£ç å¦‚ä¸‹:
```js
import React, { PureComponent } from 'react';
// Header
function Header() {
  console.log("Header renderå‡½æ•°è¢«è°ƒç”¨");
  return <h2>æˆ‘æ˜¯Headerç»„ä»¶</h2>
}
// Main
class Main extends PureComponent {
  render() {
    console.log("Main renderå‡½æ•°è¢«è°ƒç”¨");
    return (
      <div>
        <Banner/>
        <ProductList/>
      </div>
    )
  }
}
// Footer
function Footer() {
  console.log("Footer renderå‡½æ•°è¢«è°ƒç”¨");
  return <h2>æˆ‘æ˜¯Footerç»„ä»¶</h2>
}
export default class App extends PureComponent {
  constructor(props) {
    super(props);
    this.state = {
      counter: 0
    }
  }
  render() {
    console.log("App renderå‡½æ•°è¢«è°ƒç”¨");
    return (
      <div>
        <h2>å½“å‰è®¡æ•°: {this.state.counter}</h2>
        <button onClick={e => this.increment()}>+1</button>
        <Header/>
        <Main/>
        <Footer/>
      </div>
    )
  }
  increment() {
    this.setState({
      counter: this.state.counter + 1
    })
  }
}
```
è¿™æ¬¡å¯ä»¥å‘ç°ç‚¹å‡» +1æŒ‰é’®ååªä¼šæ‰“å°å‡º
```js
App renderå‡½æ•°è¢«è°ƒç”¨
Header renderå‡½æ•°è¢«è°ƒç”¨
Footer renderå‡½æ•°è¢«è°ƒç”¨
```
å› ä¸º `Main` ç»„ä»¶å†…éƒ¨æ•°æ®å‘ç”Ÿ**æµ…å±‚æ¬¡æ¯”è¾ƒ**åæ²¡æœ‰æ•°æ®å‘ç”Ÿå˜åŒ–ä»è€Œä¸é‡æ–°æ¸²æŸ“<br/>
ä¸ºä»€ä¹ˆæ˜¯æµ…å±‚æ¬¡æ¯”è¾ƒ? é‚£ä¹ˆå°±è¦é˜…è¯»ä¸€ä¸‹ `PureComponent` çš„æºç äº†<br/>
é¦–å…ˆ `PureComponent`æºç :
```js {9, 12}
function PureComponent(props, context, updater) {
  this.props = props;
  this.context = context;
  // If a component has string refs, we will assign a different object later.
  this.refs = emptyObject;
  this.updater = updater || ReactNoopUpdateQueue;
}
const pureComponentPrototype = (PureComponent.prototype = new ComponentDummy());
pureComponentPrototype.constructor = PureComponent;
// Avoid an extra prototype jump for these methods.
Object.assign(pureComponentPrototype, Component.prototype);
pureComponentPrototype.isPureReactComponent = true;
export {Component, PureComponent};
```
`checkShouldComponentUpdate` æºç :
```js
function checkShouldComponentUpdate(
  workInProgress,
  ctor,
  oldProps,
  newProps,
  oldState,
  newState,
  nextContext,
) {
  // åœ¨ PureComponentä¸­å£°æ˜äº†pureComponentPrototype.isPureReactComponent = true;
  if (ctor.prototype && ctor.prototype.isPureReactComponent) {
    return (
      !shallowEqual(oldProps, newProps) || !shallowEqual(oldState, newState)
    );
  }
  return true;
}
```
`shallowEqual` æºç :
```js
function shallowEqual(objA: mixed, objB: mixed): boolean {
  if (is(objA, objB)) {
    return true;
  }

  if (
    typeof objA !== 'object' ||
    objA === null ||
    typeof objB !== 'object' ||
    objB === null
  ) {
    return false;
  }

  const keysA = Object.keys(objA);
  const keysB = Object.keys(objB);

  if (keysA.length !== keysB.length) {
    return false;
  }

  for (let i = 0; i < keysA.length; i++) {
    if (
      !hasOwnProperty.call(objB, keysA[i]) ||
      !is(objA[keysA[i]], objB[keysA[i]])
    ) {
      return false;
    }
  }
  return true;
}
export default shallowEqual;
```
ç»“åˆä¸‰éƒ¨åˆ†æºç å¯ä»¥çœ‹å‡ºå¦‚æœç»„ä»¶ç»§æ‰¿ pureComponnet å,åœ¨æ£€æŸ¥æ˜¯å¦æ›´æ–°çš„æ—¶å€™ä¼šå¯¹ç»„å»ºçš„æ•°æ®è¿›è¡Œæµ…å±‚æ¬¡æ¯”è¾ƒåˆ¤æ–­æ˜¯å¦åˆ·æ–°ç»„ä»¶

**memo**<br/>
ç±»ç»„ä»¶çš„æ›´æ–°æ–¹æ¡ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ pureComponnet æ¥è§£å†³äº†,å‡½æ•°å¼ç»„ä»¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ memo è¿›è¡Œä¸€å±‚åŒ…è£¹,å¦‚ä¸‹ä»£ç 
```js
import React, { PureComponent, memo } from 'react';

// Header
const MemoHeader = memo(function Header() {
  console.log("Headerè¢«è°ƒç”¨");
  return <h2>æˆ‘æ˜¯Headerç»„ä»¶</h2>
})
// Main
class Main extends PureComponent {
  render() {
    console.log("Main renderå‡½æ•°è¢«è°ƒç”¨");
    return (
      <div>
        <Banner/>
        <MemoProductList/>
      </div>
    )
  }
}
// Footer
const MemoFooter = memo(function Footer() {
  console.log("Footerè¢«è°ƒç”¨");
  return <h2>æˆ‘æ˜¯Footerç»„ä»¶</h2>
})

export default class App extends PureComponent {
  constructor(props) {
    super(props);
    this.state = {
      counter: 0
    }
  }
  render() {
    console.log("App renderå‡½æ•°è¢«è°ƒç”¨");
    return (
      <div>
        <h2>å½“å‰è®¡æ•°: {this.state.counter}</h2>
        <button onClick={e => this.increment()}>+1</button>
        <MemoHeader/>
        <Main/>
        <MemoFooter/>
      </div>
    )
  }
  increment() {
    this.setState({
      counter: this.state.counter + 1
    })
  }
}
```
ç‚¹å‡»æŒ‰é’® +1 æ—¶æ§åˆ¶å°ä¸­åªè¾“å‡ºäº† App renderå‡½æ•°è¢«è°ƒç”¨

## æ€§èƒ½ä¼˜åŒ–-immutableJS

## æ€§èƒ½ä¼˜åŒ–-Hooks:useEffect

## æ€§èƒ½ä¼˜åŒ–-Hooks:useCallback

## æ€§èƒ½ä¼˜åŒ–-Hooks:useMemo
