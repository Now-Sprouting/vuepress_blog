# 3:React æ€§èƒ½ä¼˜åŒ–

è¦æƒ³äº†è§£ `React` éƒ½å¯ä»¥è¿›è¡Œå“ªäº›æ€§èƒ½çš„ä¼˜åŒ–ä¹‹å‰æˆ‘ä»¬å¿…é¡»è¦å…ˆæŒæ¡ `React` çš„æ¸²æŸ“å’Œæ›´æ–°æœºåˆ¶æ˜¯å¦‚ä½•çš„<br/>

## React æ¸²æŸ“å’Œæ›´æ–°æœºåˆ¶

åœ¨[1:JSX çš„æœ¬è´¨-æ€»ç»“](./#æ€»ç»“)ä¸­æˆ‘ä»¬å·²ç»äº†è§£äº† React æ˜¯å¦‚ä½•ä»ç¼–å†™ JSX ä»£ç åˆ°æ¸²æŸ“çš„,é‚£ä¹ˆ React çš„æ›´æ–°æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„å‘¢?<br/>
æˆ‘ä»¬å¯ä»¥ç»“åˆ React å®˜ç½‘ç»™å‡ºçš„ç”Ÿå‘½å‘¨æœŸå›¾æ¥å‚è€ƒä¸€ä¸‹<br/>
![xxx](../images/React/2/0.png)<br/>
ä¸éš¾çœ‹å‡ºåœ¨ `Updating` æ¨¡å—ä¸­åªè¦ `props` å’Œ `state` å‘ç”Ÿæ”¹å˜å°±ä¼šè§¦å‘ `render` å‡½æ•°, åœ¨ `render` å‡½æ•°ä¸­ `React` ä¼šæŠŠæ–°åˆ›å»ºå‡ºæ¥çš„ `è™šæ‹ŸDOM` å’Œ ä¹‹å‰çš„ `DOM` è¿›è¡Œå¯¹æ¯”å¹¶è®¡ç®—å‡ºæœ€åè¦è½¬æ¢æˆçš„ `DOMå¯¹è±¡æ ‘`,æœ€ç»ˆè½¬åŒ–æˆ `çœŸå®DOM` å¹¶æ¸²æŸ“åˆ°é¡µé¢ä¸Š<br/>
ä½†å¯¹æ¯”ä¸¤ä¸ªæ ‘å¹¶ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹, React å®˜ç½‘ä¸­ä¹Ÿæåˆ°äº†:
::: tip
å³ä½¿åœ¨æœ€å‰æ²¿çš„ç®—æ³•ä¸­ï¼Œè¯¥ç®—æ³•çš„å¤æ‚ç¨‹åº¦ä¸º O(n^3)ï¼Œå…¶ä¸­ n æ˜¯æ ‘ä¸­å…ƒç´ çš„æ•°é‡ã€‚
:::
è€Œ React åœ¨ä¸¤æ£µæ ‘çš„å¯¹æ¯”ä¸Šæå‡ºäº†ä¸€å¥—å¤æ‚åº¦ä¸º O(n) çš„ç®—æ³•--->Diffing

## Diffing

å…³äº React çš„ Diffing ç®—æ³•, React å®˜ç½‘ä¹Ÿç»™å‡ºäº†ç›¸åº”çš„è®²è§£,åœ¨è¿™é‡Œå¯ä»¥æ€»ç»“ä¸ºä»¥ä¸‹å‡ ç‚¹

### 1:æ¯”è¾ƒæ ¹èŠ‚ç‚¹

**å¯¹æ¯”ä¸¤æ£µæ ‘åŒä¸€çº§å…ƒç´ çš„æ ¹èŠ‚ç‚¹,æ ¹èŠ‚ç‚¹ä¸åŒ,ç›´æ¥åˆ æ‰é‡å»º,ä¸å†æ·±åº¦æ¯”è¾ƒ**
ä¸¾ä¸ªæ —å­

```js
// æ—§çš„è™šæ‹ŸDOMæ ‘
<div>
  <Counter />
</div>
// æ–°çš„è™šæ‹ŸDOMæ ‘
<span>
  <Counter />
</span>
```

å½“åˆ¤æ–­åˆ°ä¸Šé¢çš„æ ¹èŠ‚ç‚¹ `<div></div>` å’Œ `<span></span>` æ—¶,å› ä¸ºæ ¹èŠ‚ç‚¹ä¸ç›¸åŒ, æ‰€ä»¥ç›´æ¥åˆ é™¤æ—§æ ‘é‡å»ºæ–°æ ‘<br/>
**å¯¹æ¯”ä¸¤ä¸ªç›¸åŒç±»å‹çš„ React å…ƒç´ æ—¶ï¼ŒReact ä¼šä¿ç•™ DOM èŠ‚ç‚¹ï¼Œä»…æ¯”å¯¹åŠæ›´æ–°æœ‰æ”¹å˜çš„å±æ€§ã€‚**

```js
<div className="before" title="stuff" />
<div className="after" title="stuff" />
```

é€šè¿‡å¯¹æ¯”è¿™ä¸¤ä¸ªå…ƒç´ ï¼Œ`React` çŸ¥é“åªéœ€è¦ä¿®æ”¹ `DOM` å…ƒç´ ä¸Šçš„ `className` å±æ€§ã€‚<br/>
å½“æ›´æ–° style å±æ€§æ—¶ï¼ŒReact ä»…æ›´æ–°æœ‰æ‰€æ›´å˜çš„å±æ€§ã€‚æ¯”å¦‚:

```js
<div style={{color: 'red', fontWeight: 'bold'}} />
<div style={{color: 'green', fontWeight: 'bold'}} />
```

é€šè¿‡å¯¹æ¯”è¿™ä¸¤ä¸ªå…ƒç´ ï¼Œ`React`çŸ¥é“åªéœ€è¦ä¿®æ”¹ `DOM` å…ƒç´ ä¸Šçš„ `color` æ ·å¼ï¼Œæ— éœ€ä¿®æ”¹ `fontWeightã€‚`

### 2:é€’å½’æ¯”è¾ƒå­èŠ‚ç‚¹

æ¯”è¾ƒå®Œæ ¹èŠ‚ç‚¹ä¹‹å, React å°±ä¼šé€’å½’çš„æ¯”è¾ƒå­èŠ‚ç‚¹,ä¹Ÿå°±æ˜¯ä¸‹é¢çš„ä»£ç 

```js
<ul>
  <li>first</li>
  <li>second</li>
</ul>
```

æ”¹å˜ä¸º

```js
<ul>
  <li>first</li>
  <li>second</li>
  <li>third</li>
</ul>
```

React ä¼šæŒ‰ç…§é¡ºåºé€’å½’çš„æ¯”è¾ƒ `<li>first</li>` ä¸ `<li>first</li>`, `<li>second</li>` ä¸ `<li>second</li>`æœ€åå‘ç°åªæ–°å¢äº†ä¸€ä¸ª `<li>third</li>`,æ‰€ä»¥æœ€åä¼šä¿ç•™`<li>first</li>`å’Œ`<li>second</li>`, æ’å…¥æ–°å¢çš„`<li>third</li>`æ ‘,è¿™æ ·æ€§èƒ½ä¸Šä¸ä¼šæœ‰å¾ˆå¤§çš„æŸè€—,å¦‚æœä½ å°†`<li>third</li>`æ’å…¥åˆ°è¡¨å¤´çš„è¯:

```js
<ul>
  <li>first</li>
  <li>second</li>
</ul>
```

æ”¹å˜ä¸º

```js
<ul>
  <li>third</li>
  <li>first</li>
  <li>second</li>
</ul>
```

React ä¾æ—§ä¼šé»˜è®¤çš„å¯¹å­èŠ‚ç‚¹è¿›è¡Œé€’å½’çš„æ¯”è¾ƒ, ä¹Ÿå°±æ˜¯ `<li>first</li>` ä¸ `<li>third</li>` `<li>second</li>`ä¸ `<li>first</li>`å› ä¸ºä¸¤ä¸ªèŠ‚ç‚¹çš„å­å…ƒç´ å¹¶ä¸ç›¸åŒ,æ‰€ä»¥ä¼šé‡å»ºæ¯ä¸€ä¸ªå­å…ƒç´ , è¿™æ ·ä¼šäº§ç”Ÿæ€§èƒ½ä¸Šçš„é—®é¢˜,æ‰€ä»¥æ¥ä¸‹æ¥ [æ€§èƒ½ä¼˜åŒ–-Keys](#æ€§èƒ½ä¼˜åŒ–-keys) å°±ç™»åœºäº†

## æ€§èƒ½ä¼˜åŒ–-keys

ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜, `React` æ¨èæˆ‘ä»¬ä½¿ç”¨ `key` å±æ€§, å½“ä¸€ä¸ªå…ƒç´ æœ‰ `key` å±æ€§ä¹‹å, `React` ä¼šä½¿ç”¨ `key` æ¥åŒ¹é…åŸæ ‘å’Œæ–°æ ‘çš„å­å…ƒç´ , å¦‚ä¸‹ä»£ç 

```js
<ul>
  <li key="1">first</li>
  <li key="2">second</li>
</ul>
```

è½¬æ¢ä¸º

```js
<ul>
  <li key="3">third</li>
  <li key="1">first</li>
  <li key="2">second</li>
</ul>
```

å› ä¸º React ä¼šæ ¹æ® key è¿›è¡ŒåŒ¹é…ç„¶åè¿›è¡Œæ¯”è¾ƒ,å‘ç°åªæœ‰`<li key="3">third</li>`æ˜¯æ–°å…ƒç´ ,æ‰€ä»¥åªæ˜¯æ’å…¥ä¸€ä¸‹æ–°å…ƒç´ ç„¶åæ”¹å˜ä¸€ä¸‹
`<li key="1">first</li>` å’Œ `<li key="2">second</li>`çš„ä½ç½®å³å¯,è¿™æ ·åœ¨æ€§èƒ½ä¸Šå°±æœ‰äº†å¾ˆå¤§çš„æå‡<br/>
**key çš„æ³¨æ„äº‹é¡¹**
:::tip
key åº”è¯¥æ˜¯å”¯ä¸€çš„<br/>
key ä¸è¦ä½¿ç”¨éšæœºæ•°ï¼ˆéšæœºæ•°åœ¨ä¸‹ä¸€æ¬¡ render æ—¶ï¼Œä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ªæ•°å­—)<br/>
ä½¿ç”¨ index ä½œä¸º keyï¼Œå¯¹æ€§èƒ½æ˜¯æ²¡æœ‰ä¼˜åŒ–çš„<br/>
:::

## æ€§èƒ½ä¼˜åŒ–-shouldComponentUpdate

åœ¨ä½¿ç”¨ shouldComponentUpdate ä¹‹å‰æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ä¸‹é¢çš„ä»£ç 

```js
import React, { Component } from "react";
// Header
function Header() {
  console.log("Header renderå‡½æ•°è¢«è°ƒç”¨");
  return <h2>æˆ‘æ˜¯Headerç»„ä»¶</h2>;
}
// Main
class Main extends Component {
  render() {
    console.log("Main renderå‡½æ•°è¢«è°ƒç”¨");
    return (
      <div>
        <Banner />
        <ProductList />
      </div>
    );
  }
}
// Footer
function Footer() {
  console.log("Footer renderå‡½æ•°è¢«è°ƒç”¨");
  return <h2>æˆ‘æ˜¯Footerç»„ä»¶</h2>;
}

export default class App extends Component {
  constructor(props) {
    super(props);
    this.state = {
      counter: 0,
    };
  }
  render() {
    console.log("App renderå‡½æ•°è¢«è°ƒç”¨");
    return (
      <div>
        <h2>å½“å‰è®¡æ•°: {this.state.counter}</h2>
        <button onClick={(e) => this.increment()}>+1</button>
        <Header />
        <Main />
        <Footer />
      </div>
    );
  }
  increment() {
    this.setState({
      counter: this.state.counter + 1,
    });
  }
}
```

ä»£ç ç»“æ„å¾ˆæ¸…æ™°,å¦‚å›¾<br/>
<br/>
![xxx](../images/React/2/1.svg)<br/>
å½“ App ç¬¬ä¸€æ¬¡åŠ è½½æ—¶ï¼Œæµè§ˆå™¨ä¼šæ‰“å°å‡º

```js
App renderå‡½æ•°è¢«è°ƒç”¨
Headerè¢«è°ƒç”¨
Main renderå‡½æ•°è¢«è°ƒç”¨
Footer renderå‡½æ•°è¢«è°ƒç”¨
```

ä¸Šé¢çš„ç»“æœåº”è¯¥æ˜¯æˆ‘ä»¬é¢„æœŸçš„ç»“æœ,ç¬¬ä¸€æ¬¡æ‰“å¼€é¡µé¢æ—¶,åŠ è½½ App ç»„ä»¶ä»¥åŠå­ç»„ä»¶<br/>
æ¥ä¸‹æ¥æˆ‘ä»¬ç‚¹å‡» `<butoon>+1</button>`æŒ‰é’®å,æµè§ˆå™¨ä¾æ—§ä¼šæ‰“å°å‡º

```js
App renderå‡½æ•°è¢«è°ƒç”¨
Header renderå‡½æ•°è¢«è°ƒç”¨
Main renderå‡½æ•°è¢«è°ƒç”¨
Footer renderå‡½æ•°è¢«è°ƒç”¨
```

æˆ‘ä»¬å¯ä»¥èµ°ä¸€ä¸‹æµç¨‹, ç‚¹å‡»`<butoon>+1</button>`å, App ç»„ä»¶å†… state å‘ç”Ÿæ”¹å˜æ‰€ä»¥ä¼šæ‰“å°å‡º `App renderå‡½æ•°è¢«è°ƒç”¨`,éšå `Header` `Main` `Banner` ç»„ä»¶ä¹Ÿé‡æ–°åŠ è½½äº†,è¿™æ˜¯å› ä¸º `React` å†…éƒ¨**é»˜è®¤**(è¿™ä¸ªé»˜è®¤ä¸‹é¢ä¼šè®²åˆ°)æƒ…å†µä¸‹å½“çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶å­ç»„ä»¶ä¹Ÿè·Ÿç€ä¸€èµ·é‡æ–°æ¸²æŸ“<br/>
è¿™æ—¶å€™å°±å¼•èµ·äº†æˆ‘ä»¬çš„æ€è€ƒ,æˆ‘ä»¬åªæ˜¯æ”¹å˜äº† App ç»„ä»¶ä¸­çš„ state è€Œæ‰€æœ‰å­ç»„ä»¶ä¹Ÿä¸€èµ·é‡æ–°æ¸²æŸ“äº†,è¿™æ ·æ¥åšæµªè´¹äº†å¾ˆå¤šçš„æ€§èƒ½,é‚£ä¹ˆæœ‰ä»€ä¹ˆåŠæ³•å‘¢?<br/>
æˆ‘ä»¬å¯ä»¥å†çœ‹ä¸€ä¸‹ React å®˜æ–¹æ¯”è¾ƒè¯¦ç»†çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°, å¦‚å›¾:<br/>
![xxx](../images/React/2/2.png)<br/>
å¯ä»¥çœ‹å‡ºåœ¨ Updating æ¨¡å—ä¸­å¤šå‡ºäº† `shouldComponentUpadateUpdate` ç”Ÿå‘½å‘¨æœŸå‡½æ•°,è¿™ä¸ªå‡½æ•°åœ¨ `render` å‡½æ•°ä¹‹å‰,ä¹Ÿå°±æ˜¯æ‰€æˆ‘ä»¬å¯ä»¥æ ¹æ® `shouldComponentUpadateUpdate`çš„è¿”å›å€¼æ¥å†³å®šæ˜¯å¦æ‰§è¡Œ `render` å‡½æ•°,æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„ä»£ç :

```js
import React, { Component } from "react";

export default class App extends Component {
  constructor(props) {
    super(props);
    this.state = {
      counter: 0,
    };
  }
  render() {
    console.log("App renderå‡½æ•°è¢«è°ƒç”¨");
    return (
      <div>
        <h2>å½“å‰è®¡æ•°: {this.state.counter}</h2>
        <button onClick={(e) => this.increment()}>+1</button>
      </div>
    );
  }

  shouldComponentUpdate(nextProps, nextState) {
    return false;
  }
  increment() {
    this.setState({
      counter: this.state.counter + 1,
    });
  }
}
```

æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®,ç»“æœè®¡æ•°å¹¶æ²¡æœ‰å¢åŠ ,æ§åˆ¶å°ä¹Ÿæ²¡æ‰“å°å‡º `App renderå‡½æ•°è¢«è°ƒç”¨`,å¯ä»¥çœ‹å‡º `render` å‡½æ•°å·²ç»è¢«é˜»æ–­äº†,æœ‰äº†è¿™ä¸ªå‡½æ•°å°±å¯ä»¥åœ¨ç»„ä»¶çš„ `render` å‡½æ•°è°ƒç”¨å‰åˆ¤æ–­æ˜¯å¦è°ƒç”¨ `render` å‡½æ•°æ¥ç¡®å®šæ˜¯å¦é‡æ–°æ¸²æŸ“ç»„ä»¶äº†,å¦‚ä¸‹ä¾‹å­

```js
import React, { Component } from "react";
export default class App extends Component {
  constructor(props) {
    super(props);

    this.state = {
      counter: 0,
      message: "Hello World",
    };
  }
  render() {
    console.log("App renderå‡½æ•°è¢«è°ƒç”¨");
    return (
      <div>
        <h2>å½“å‰è®¡æ•°: {this.state.counter}</h2>
        <button onClick={(e) => this.increment()}>+1</button>
        <button onClick={(e) => this.changeText()}>æ”¹å˜æ–‡æœ¬</button>
      </div>
    );
  }
  increment() {
    this.setState({
      counter: this.state.counter + 1,
    });
  }
  changeText() {
    this.setState({
      message: "Hello React",
    });
  }
}
```

`App` ç»„ä»¶ä¸­ `state` æœ‰ `counter` å’Œ `message`ä½†æ­¤ç»„ä»¶å¹¶ä¸ä¾èµ–äº `message`<br/>æˆ‘ä»¬æœ‰ä»¥ä¸‹éœ€æ±‚:æ”¹å˜ `message` ä¸é‡æ–°æ¸²æŸ“ç»„ä»¶,åªæœ‰æ”¹å˜ `counter` çš„æ—¶å€™æ‰é‡æ–°æ¸²æŸ“ç»„ä»¶<br/>
å¯ä»¥åœ¨ App ä¸­å¢åŠ  ä»¥ä¸‹ä»£ç 

```js
 shouldComponentUpdate(nextProps, nextState) {
    //nextPropsä¸ºæ–°çš„props, nextStateä¸ºæ–°çš„state
    if (this.state.counter !== nextState.counter) {
      return true;
    }
    return false;
  }
```
è¿™æ ·æˆ‘ä»¬ç‚¹å‡»æ”¹å˜æ–‡æœ¬ç»„ä»¶å°±ä¸ä¼šé‡æ–°æ¸²æŸ“äº†<br/>
é‚£ä¹ˆ `shouldComponentUpadate` ä¸ºä»€ä¹ˆå°±ä¼šå†³å®šç»„ä»¶çš„æ›´æ–°ä¸å¦å‘¢? æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ `React` çš„æºç æ¥è¿›ä¸€æ­¥äº†è§£<br/>
åœ¨æºç çš„ `ReactFiberClassComponent.js`æ–‡ä»¶ä¸­ `checkShouldComponentUpdate`å‡½æ•°åˆ¤æ–­ç»„ä»¶æ›´æ–°ä¸å¦,å¦‚ä¸‹:
```js
function checkShouldComponentUpdate(
  workInProgress,
  ctor,
  oldProps,
  newProps,
  oldState,
  newState,
  nextContext,
) {
  const instance = workInProgress.stateNode;
  if (typeof instance.shouldComponentUpdate === 'function') {
    const shouldUpdate = instance.shouldComponentUpdate(
      newProps,
      newState,
      nextContext,
    );
    return shouldUpdate;
  }
  if (ctor.prototype && ctor.prototype.isPureReactComponent) {
    return (
      !shallowEqual(oldProps, newProps) || !shallowEqual(oldState, newState)
    );
  }
  return true;
}
```
è¿™ä¸ªå‡½æ•°é»˜è®¤è¿”å› `true`,ä¹Ÿå°±æ˜¯å‰é¢çš„é»˜è®¤æƒ…å†µä¸‹çˆ¶ç»„ä»¶æ›´æ–°å­ç»„ä»¶é‡æ–°æ¸²æŸ“çš„æƒ…å†µ,å¦‚æœè¯¥ç»„ä»¶ä¸­å­˜åœ¨ `shouldComponentUpdate`åˆ™è¿”å›å€¼ä¸º `shouldComponentUpdate` çš„è¿”å›å€¼<br/>
æœ‰äº† `shouldComponentUpadate` çš„åŸºç¡€æˆ‘ä»¬å°±å¯ä»¥ç†è§£ React çš„**ä¸å¯å˜æ•°æ®åŠ›é‡**äº†<br/>
åœ¨[2:setState](./1.html#ä¸å¯å˜å€¼-å‡½æ•°å¼ç¼–ç¨‹-çº¯å‡½æ•°)ä¸­æˆ‘ä»¬æåˆ°è¿‡**ä¸å¯å˜æ•°æ®çš„åŠ›é‡**æˆ‘ä»¬æ¥ç€ç”¨é‚£ä¸ªæ¡ˆä¾‹
```js
export default class APP extends Component {
    constructor(props) {
        super(props)
        this.state = {
            list: ['ğŸapple', 'ğŸŒbanana', 'ğŸ…tomato']
        }
    }
    render() {
        return (
            <div style={{margin: '200px auto', width: '200px'}}>
                {this.state.list.map((item) => {
                    return (
                        <h1 key={item}>{item}</h1>
                    )
                })}
                <button onClick={e => {this.addPotato()}}>ï¼‹ğŸ¥”</button>
            </div>
        );
    }
    addPotato() {
        this.state.list.push('ğŸ¥”potato')
        this.setState({
            list: this.state.list
        })
    }
}
```
ç‚¹å‡»æŒ‰é’®å¯ä»¥å®ç°å¯¹åˆ—è¡¨æ•°æ®çš„å¢åŠ ,ä½†æ˜¯æƒ³ç”¨ shouldComponent æ¥é‡æ„ä»¥ä¸‹ä»£ç æ¥å®ç°ä¸€äº›ç»„ä»¶çš„ä¸å¿…è¦æ¸²æŸ“,å¦‚ä¸‹
```js
export default class APP extends Component {
    constructor(props) {
        super(props)
        this.state = {
            list: ['ğŸapple', 'ğŸŒbanana', 'ğŸ…tomato']
        }
    }
    render() {
        return (
            <div style={{margin: '200px auto', width: '200px'}}>
                {this.state.list.map((item) => {
                    return (
                        <h1 key={item}>{item}</h1>
                    )
                })}
                <button onClick={e => {this.addPotato()}}>ï¼‹ğŸ¥”</button>
            </div>
        );
    }
    shouldComponentUpdate(nextProps, nextState) {
        if (this.state.list !== nextState.list) {
          return true;
        }
        return false;
    }
    addPotato() {
        this.state.list.push('ğŸ¥”potato')
        this.setState({
            list: this.state.list
        })
    }
}
```
æ‰§è¡Œä¸Šè¿°ä»£ç ,ç‚¹å‡»æŒ‰é’®,å‘ç°åˆ—è¡¨å¹¶æ²¡æœ‰é‡æ–°åˆ·æ–°,è¿™æ˜¯å› ä¸ºåœ¨ `setState` å‰å¯¹ `list` æ•°æ®è¿›è¡Œç›´æ¥çš„ä¿®æ”¹,è€Œåœ¨ `setState` ä¸­
`list` å’Œ `this.state.list` ç”¨çš„æ˜¯åŒä¸€ä¸ªå¼•ç”¨æ‰€ä»¥åœ¨ `shouldComponentUpadate` è¿”å› `false` ç»„ä»¶ä¸ä¼šé‡æ–°æ¸²æŸ“,æ¨¡æ‹Ÿå†…å­˜ç»“æ„å¦‚ä¸‹:<br/></br></br>
![xxx](../images/React/2/3.svg)<br/>
ä¿®æ”¹ `addPotato(){}` ä»£ç å
```js
    addPotato() {
        const newList = this.state.list.concat('ğŸ¥”potato')
        this.setState({
            list: newList
        })
    }
```
æ¨¡æ‹Ÿå†…å­˜ç»“æ„å¦‚ä¸‹<br/><br/><br/>
![xxx](../images/React/2/4.svg)<br/>

## æ€§èƒ½ä¼˜åŒ–-PureComponent å’Œ memo
ç†Ÿæ‚‰äº† `shouldComponentUpadateUpdate` ä¹‹å,è€ƒè™‘åˆ°æ€§èƒ½çš„ä¼˜åŒ–æˆ‘ä»¬è‚¯å®šä¼šä¼˜å…ˆè€ƒè™‘åœ¨ç»„ä»¶ä¸­ä½¿ç”¨å®ƒ,ä½†å­˜åœ¨ä»¥ä¸‹å‡ ç‚¹é—®é¢˜:<br/>
- å¦‚æœæ¯ä¸ªç»„ä»¶éƒ½å†™ä¸€ä¸ª `shouldComponentUpadateUpdate`ä¼šå‡ºç°éå¸¸å¤šçš„é‡å¤ä»£ç 
- å‡½æ•°å¼ç»„ä»¶å¹¶æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸ<br/>
ä¸ºäº†è§£å†³ä»¥ä¸Šé—®é¢˜ `PureComponent` `memo` å°±å¯ä»¥å®£å¸ƒç™»åœºäº†
**PureComponent**<br/>
ç±»ç»„ä»¶åªè¦ç»§æ‰¿ `PureComponent` é»˜è®¤åœ¨å‘ç”Ÿ `Updating` æ—¶å°±ä¼šå¯¹å†…éƒ¨æ•°æ®è¿›è¡Œæ¯”è¾ƒåˆ¤æ–­æ˜¯å¦é‡æ–°æ¸²æŸ“(ç›¸å½“äº `shouldComponentUpdate`)<br/>ä»£ç å¦‚ä¸‹:
```js
import React, { PureComponent } from 'react';
// Header
function Header() {
  console.log("Header renderå‡½æ•°è¢«è°ƒç”¨");
  return <h2>æˆ‘æ˜¯Headerç»„ä»¶</h2>
}
// Main
class Main extends PureComponent {
  render() {
    console.log("Main renderå‡½æ•°è¢«è°ƒç”¨");
    return (
      <div>
        <Banner/>
        <ProductList/>
      </div>
    )
  }
}
// Footer
function Footer() {
  console.log("Footer renderå‡½æ•°è¢«è°ƒç”¨");
  return <h2>æˆ‘æ˜¯Footerç»„ä»¶</h2>
}
export default class App extends PureComponent {
  constructor(props) {
    super(props);
    this.state = {
      counter: 0
    }
  }
  render() {
    console.log("App renderå‡½æ•°è¢«è°ƒç”¨");
    return (
      <div>
        <h2>å½“å‰è®¡æ•°: {this.state.counter}</h2>
        <button onClick={e => this.increment()}>+1</button>
        <Header/>
        <Main/>
        <Footer/>
      </div>
    )
  }
  increment() {
    this.setState({
      counter: this.state.counter + 1
    })
  }
}
```
è¿™æ¬¡å¯ä»¥å‘ç°ç‚¹å‡» +1æŒ‰é’®ååªä¼šæ‰“å°å‡º
```js
App renderå‡½æ•°è¢«è°ƒç”¨
Header renderå‡½æ•°è¢«è°ƒç”¨
Footer renderå‡½æ•°è¢«è°ƒç”¨
```
å› ä¸º `Main` ç»„ä»¶å†…éƒ¨æ•°æ®å‘ç”Ÿ**æµ…å±‚æ¬¡æ¯”è¾ƒ**åæ²¡æœ‰æ•°æ®å‘ç”Ÿå˜åŒ–ä»è€Œä¸é‡æ–°æ¸²æŸ“<br/>
ä¸ºä»€ä¹ˆæ˜¯æµ…å±‚æ¬¡æ¯”è¾ƒ? é‚£ä¹ˆå°±è¦é˜…è¯»ä¸€ä¸‹ `PureComponent` çš„æºç äº†<br/>
é¦–å…ˆ `PureComponent`æºç :
```js
function PureComponent(props, context, updater) {
  this.props = props;
  this.context = context;
  // If a component has string refs, we will assign a different object later.
  this.refs = emptyObject;
  this.updater = updater || ReactNoopUpdateQueue;
}
const pureComponentPrototype = (PureComponent.prototype = new ComponentDummy());
pureComponentPrototype.constructor = PureComponent;
// Avoid an extra prototype jump for these methods.
Object.assign(pureComponentPrototype, Component.prototype);
pureComponentPrototype.isPureReactComponent = true;
export {Component, PureComponent};
```
`checkShouldComponentUpdate` æºç :
```js
function checkShouldComponentUpdate(
  workInProgress,
  ctor,
  oldProps,
  newProps,
  oldState,
  newState,
  nextContext,
) {
  // åœ¨ PureComponentä¸­å£°æ˜äº†pureComponentPrototype.isPureReactComponent = true;
  if (ctor.prototype && ctor.prototype.isPureReactComponent) {
    return (
      !shallowEqual(oldProps, newProps) || !shallowEqual(oldState, newState)
    );
  }
  return true;
}
```
`shallowEqual` æºç :
```js
function shallowEqual(objA: mixed, objB: mixed): boolean {
  // ç¬¬ä¸€å±‚åˆ¤æ–­:ä¸‹é¢çš„ is ç›¸å½“äº === çš„åŠŸèƒ½
  if (is(objA, objB)) {
    return true;
  }
  // ç¬¬äºŒå±‚åˆ¤æ–­:åªè¦æœ‰ä¸€ä¸ªä¸æ˜¯å¯¹è±¡æ•°æ®ç±»å‹å°±è¿”å› false
  if (
    typeof objA !== 'object' ||
    objA === null ||
    typeof objB !== 'object' ||
    objB === null
  ) {
    return false;
  }
  // ç¬¬ä¸‰å±‚åˆ¤æ–­:æ¯”è¾ƒä¸¤è€…çš„å±æ€§æ•°é‡æ˜¯å¦ç›¸ç­‰
  const keysA = Object.keys(objA);
  const keysB = Object.keys(objB);
  if (keysA.length !== keysB.length) {
    return false;
  }
  // ç¬¬å››å±‚åˆ¤æ–­:æ¯”è¾ƒä¸¤è€…çš„å±æ€§æ˜¯å¦ç›¸ç­‰ï¼Œå€¼æ˜¯å¦ç›¸ç­‰
  for (let i = 0; i < keysA.length; i++) {
    if (
      !hasOwnProperty.call(objB, keysA[i]) ||
      !is(objA[keysA[i]], objB[keysA[i]])
    ) {
      return false;
    }
  }
  return true;
}
export default shallowEqual;
```
ç»“åˆä¸‰éƒ¨åˆ†æºç å¯ä»¥çœ‹å‡ºå¦‚æœç»„ä»¶ç»§æ‰¿ pureComponnet å,åœ¨æ£€æŸ¥æ˜¯å¦æ›´æ–°çš„æ—¶å€™ä¼šå¯¹ç»„ä»¶çš„æ•°æ®è¿›è¡Œæµ…å±‚æ¬¡æ¯”è¾ƒåˆ¤æ–­æ˜¯å¦åˆ·æ–°ç»„ä»¶

**memo**<br/>
ç±»ç»„ä»¶çš„æ›´æ–°æ–¹æ¡ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ pureComponnet æ¥è§£å†³äº†,å‡½æ•°å¼ç»„ä»¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ memo è¿›è¡Œä¸€å±‚åŒ…è£¹,å¦‚ä¸‹ä»£ç 
```js
import React, { PureComponent, memo } from 'react';

// Header
const MemoHeader = memo(function Header() {
  console.log("Headerè¢«è°ƒç”¨");
  return <h2>æˆ‘æ˜¯Headerç»„ä»¶</h2>
})
// Main
class Main extends PureComponent {
  render() {
    console.log("Main renderå‡½æ•°è¢«è°ƒç”¨");
    return (
      <div>
        <Banner/>
        <MemoProductList/>
      </div>
    )
  }
}
// Footer
const MemoFooter = memo(function Footer() {
  console.log("Footerè¢«è°ƒç”¨");
  return <h2>æˆ‘æ˜¯Footerç»„ä»¶</h2>
})

export default class App extends PureComponent {
  constructor(props) {
    super(props);
    this.state = {
      counter: 0
    }
  }
  render() {
    console.log("App renderå‡½æ•°è¢«è°ƒç”¨");
    return (
      <div>
        <h2>å½“å‰è®¡æ•°: {this.state.counter}</h2>
        <button onClick={e => this.increment()}>+1</button>
        <MemoHeader/>
        <Main/>
        <MemoFooter/>
      </div>
    )
  }
  increment() {
    this.setState({
      counter: this.state.counter + 1
    })
  }
}
```
ç‚¹å‡»æŒ‰é’® +1 æ—¶æ§åˆ¶å°ä¸­åªè¾“å‡ºäº† App renderå‡½æ•°è¢«è°ƒç”¨

## æ€§èƒ½ä¼˜åŒ–-immutableJS
åœ¨ React å¼€å‘ä¸­ï¼Œæ— è®ºæ˜¯ç±»ç»„ä»¶ä¸­çš„ `state`ï¼Œè¿˜æ˜¯ `redux` ä¸­ç®¡ç†çš„ `state` ,æˆ‘ä»¬éƒ½å¼ºè°ƒ**æ•°æ®çš„ä¸å¯å˜æ€§**,å…³äºæ•°æ®çš„ä¸å¯å˜æ€§,ä¸Šé¢çš„**ä¸å¯å˜æ•°æ®çš„åŠ›é‡**å·²ç»æåˆ°è¿‡<br/>
åœ¨ç»´æŒæ•°æ®çš„ä¸å¯å˜æ€§çš„åŸºç¡€ä¸Šå†™çš„å¤§é‡ä¿®æ”¹æ•°æ®çš„åŠæ³•éƒ½æ˜¯é€šè¿‡ `Object.assign`,`æ‰©å±•è¿ç®—ç¬¦`,æˆ–è€…`concat`æ–¹æ³•æ¥è§£å†³çš„,å¦‚ä¸‹ä»£ç :
```js
// ç»™ list åˆ—è¡¨å¢åŠ æ•°æ® 
addPotato() {
    const newList = this.state.list.concat('ğŸ¥”potato')
    this.setState({
        list: newList
    })
}
```
ä»æ€§èƒ½çš„è§’åº¦æ¥è¯´ï¼Œä¸Šé¢è¿™ç§æµ…æ‹·è´çš„æ–¹å¼æœ‰æ²¡æœ‰é—®é¢˜å‘¢,ä¸Šé¢è¿™ç§å¾®å°çš„æ•°æ®è‚¯å®šæ˜¯ä¸ä¼šé€ æˆå¤ªå¤§çš„å½±å“çš„ï¼Œå¦‚æœå¯¹è±¡è¿‡äºåºå¤§ï¼Œè¿™ç§æ‹·è´çš„æ–¹å¼ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ä»¥åŠå†…å­˜æµªè´¹<br/>
ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œå‡ºç°äº† `Immutable` å¯¹è±¡çš„æ¦‚å¿µ:
- **åªè¦ä¿®æ”¹äº†å¯¹è±¡ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ—§çš„å¯¹è±¡ä¸ä¼šå‘ç”Ÿæ”¹å˜**
- **å½“æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯æ–°çš„å¯¹è±¡ä¼šå°½å¯èƒ½çš„åˆ©ç”¨ä¹‹å‰çš„æ•°æ®ç»“æ„è€Œä¸ä¼šå¯¹å†…å­˜é€ æˆæµªè´¹(Immutableçš„æ ¸å¿ƒæ¦‚å¿µ:ç»“æ„å…±äº«)**<br/>
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›ç®€å•çš„æ¡ˆä¾‹æ¥å¯¹ immtableJS è¿›è¡Œä¸€ä¸‹æ¼”ç»ƒ,ä½†å‰ææ˜¯ä½ è¦é€šè¿‡ CDN æˆ–è€… npmä¸‹è½½æ¥ä½¿ç”¨ immtableJS<br/>
**ä¿®æ”¹ Object æ•°æ®**
```js
const im = Immutable;
const info = {
    name: "Curry",
    number: 30,
}
// å¯¹è±¡ä½¿ç”¨ im.MapåŒ…è£¹ç”Ÿæˆ immutable å¯¹è±¡
const infoIM = im.Map(info);
// è¿™é‡Œçš„ infoIM2 è¿”å›äº†ä¸€ä¸ªæ–°çš„å¯¹è±¡å°½å¯èƒ½çš„åˆ©ç”¨åŸæ¥çš„æ•°æ®,ä½†æ˜¯æ˜¯æµ…å±‚æ¬¡çš„
const infoIM2 = infoIM.set("name", "Seth");
// é€šè¿‡ set ä¿®æ”¹æ•°æ®, get è·å–æ•°æ®
console.log(infoIM.get("name")); //Curry
console.log(infoIM2.get("name")); //Seth
```
**ä¿®æ”¹ Array æ•°æ®**
```js
const lists = ["ğŸapple", "ğŸŒbanana", "ğŸ…tomato"];
// æ•°ç»„ä½¿ç”¨ im.List åŒ…è£¹
const listsIM = im.List(lists);
const newListIM = listsIM.set(0, "ğŸ¥”potato");
console.log(listsIM.get(0)); //ğŸapple
console.log(newListIM.get(0)); //ğŸ¥”potato
```
**å¦‚æœæ¶‰åŠåˆ°æ·±æ‹·è´çš„ç±»å‹ä½¿ç”¨ formJS**
```js
const info = {
    name: "Curry",
    number: 30,
    friend: {
        name: "Kely",
        number: 11
    }
}
// åˆ©ç”¨ im.Map infoIM.get("friend")ä¾æ—§æ˜¯æ™®é€šçš„ JS å¯¹è±¡
const infoIM = im.Map(info);
console.log(infoIM.get("friend"));
//{name: "james", age: 25}
```
æ‰€ä»¥ä½¿ç”¨ im.formJS å
```js
const infoIM = im.formJS(info);
// è¿™é‡Œçš„ infoIM.get("friend")å°±å˜æˆäº† immutableå¯¹è±¡
console.log(infoIM.get("friend"));
//ctÂ {size: 2, _root: pt, __ownerID: undefined, __hash: undefined, __altered: false}
```

## æ€§èƒ½ä¼˜åŒ–-Hooks:useEffect
é»˜è®¤æƒ…å†µä¸‹ï¼ŒuseEffectçš„å›è°ƒå‡½æ•°ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½é‡æ–°æ‰§è¡Œï¼Œä½†æ˜¯è¿™ä¼šå¯¼è‡´ä¸¤ä¸ªé—®é¢˜ï¼š
- æŸäº›ä»£ç æˆ‘ä»¬åªæ˜¯å¸Œæœ›æ‰§è¡Œä¸€æ¬¡å³å¯ï¼Œç±»ä¼¼äºç±»ç»„ä»¶ä¸­çš„ componentDidMount å’Œ componentWillUnmount ä¸­å®Œæˆçš„äº‹æƒ…ï¼›(æ¯”å¦‚ç½‘ç»œè¯·æ±‚ã€è®¢é˜…å’Œå–æ¶ˆè®¢é˜…)
- å¤šæ¬¡æ‰§è¡Œä¹Ÿä¼šå¯¼è‡´ä¸€å®šçš„æ€§èƒ½é—®é¢˜
æˆ‘ä»¬å¦‚ä½•å†³å®š useEffect åœ¨ä»€ä¹ˆæ—¶å€™åº”è¯¥æ‰§è¡Œå’Œä»€ä¹ˆæ—¶å€™ä¸åº”è¯¥æ‰§è¡Œå‘¢?<br/>
**useEffectå®é™…ä¸Šæœ‰ä¸¤ä¸ªå‚æ•°ï¼š**
- å‚æ•°ä¸€ï¼šæ‰§è¡Œçš„å›è°ƒå‡½æ•°ï¼›
- å‚æ•°äºŒï¼šè¯¥ `useEffect` åœ¨å“ªäº› `state` å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰é‡æ–°æ‰§è¡Œ<br/>
å¯ä»¥æ‹¿å¦‚ä¸‹ä»£ç æ¼”ç¤ºä¸€ä¸‹:
```js
import React, { useState, useEffect } from 'react';

export default function EffectPerformance() {
  const [count, setCount] = useState(0);
  const [show, setShow] = useState(true);
  // åœ¨ useEffect ä¸­ä¼ å…¥äº†ç¬¬äºŒä¸ªå‚æ•° [count]
  useEffect(() => {
    console.log("ä¿®æ”¹count");
  }, [count])

  return (
    <div>
      <h2>å½“å‰è®¡æ•°: {count}</h2>
      <button onClick={e => setCount(count + 1)}>+1</button>
      <button onClick={e => setShow(!show)}>åˆ‡æ¢</button>
    </div>
  )
}
```
å½“ç‚¹å‡»æŒ‰é’®åˆ‡æ¢æ—¶, é€šè¿‡ `setShow` æ”¹å˜äº† `show` çš„å€¼,ä½†æ§åˆ¶å°å¹¶ä¸ä¼šæ‰“å°å‡º`ä¿®æ”¹count`,åŸå› æ˜¯ åœ¨ `useEffect` ä¸­ä¼ å…¥äº†ç¬¬äºŒä¸ªå‚æ•° `[count]`,åªæœ‰å½“ç¬¬ä¸€æ¬¡æ¸²æŸ“æˆ–è€… `count` å‘ç”Ÿæ”¹å˜æ—¶æ‰ä¼šæ‰§è¡Œ `useEffect` ä¸­çš„ç¨‹åº<br/>
å¦‚æœä¸€ä¸ªå‡½æ•°æˆ‘ä»¬ä¸å¸Œæœ›ä¾èµ–ä»»ä½•çš„å†…å®¹æ—¶,å¯ä»¥ä¼ å…¥ä¸€ä¸ªç©ºçš„æ•°ç»„<br/>
```js
useEffect(() => {
  // åŠ è½½æ—¶æ‰“å°
  console.log("componentDidMount");
  // å¸è½½æ—¶æ‰“å°
  return () => {
    console.log("componentWillUnmount");
  }
}, [])
```
å› ä¸ºä¸Šé¢çš„ `useEffect` ä¸ä¾èµ–ä»»ä½•æ•°æ®æ‰€ä»¥åªä¼šåœ¨ç¬¬ä¸€æ¬¡åŠ è½½æ—¶æ‰“å° `componentDidMount` åœ¨ç»„ä»¶è¢«å¸è½½æ—¶æ‰“å° `componentWillUnmount`
## æ€§èƒ½ä¼˜åŒ–-Hooks:useCallback
è°ˆ useCallback ä¹‹å‰æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ä¸‹é¢ä»£ç 
```js
const SonBtn = (props) => {
    console.log('SonBtnå­ç»„ä»¶è¢«æ‰§è¡Œ' + props.title);
    return <button onClick={props.increment}>SonBtn + 1</button>
}

export default function Father() {
    const [count, setcount] = useState(0)
    const [show, setshow] = useState(false)

    const increment1 = () => {
        console.log('æ‰§è¡Œincrement1å‡½æ•°')
        setcount(count + 1)
    }
    const increment2 = () => {
        console.log('æ‰§è¡Œincrement2å‡½æ•°')
        setcount(count + 1)
    }

    return (
        <div>
            <h2>å½“å‰è®¡æ•°{count}</h2>
            <SonBtn increment={increment1} title='incremnet1' />
            <SonBtn increment={increment2} title='incremnet2' />
            <button onClick={e => { setshow(!show) }}>changeShow</button>
        </div>
    )
}
```
ç‚¹å‡» changeShowæŒ‰é’®,æ¯‹åº¸ç½®ç–‘,æ§åˆ¶å°ä¼šæ‰“å°å‡º `SonBtnå­ç»„ä»¶è¢«æ‰§è¡Œincremnet1` `SonBtnå­ç»„ä»¶è¢«æ‰§è¡Œincremnet2`å› ä¸ºçˆ¶ç»„ä»¶ä¸­çš„ show æ•°æ®å‘ç”Ÿäº†æ”¹å˜,çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“,å­ç»„ä»¶è‚¯å®šä¹Ÿä¼šé‡æ–°æ¸²æŸ“<br/>
æˆ‘ä»¬ä¹‹å‰å­¦ä¹ è¿‡ `memo` çš„ä½¿ç”¨,æˆ‘ä»¬ç°åœ¨å¯¹ `SonBtnç»„ä»¶` è¿›è¡Œ `memo` åŒ…è£¹,å¦‚ä¸‹:
```js
const SonBtn = memo(
  (props) => {
    console.log('SonBtnå­ç»„ä»¶è¢«æ‰§è¡Œ' + props.title);
    return <button onClick={props.increment}>SonBtn + 1</button>
})
```
å†æ¬¡ç‚¹å‡» changeShowæŒ‰é’®,æ§åˆ¶å°ä¼šæ‰“å°å‡ºä»€ä¹ˆå‘¢? æ§åˆ¶å°ä¾æ—§ä¼šæ‰“å°å‡º `SonBtnå­ç»„ä»¶è¢«æ‰§è¡Œincremnet1` `SonBtnå­ç»„ä»¶è¢«æ‰§è¡Œincremnet2`<br/>
æˆ‘ä»¬æ‹ä¸€ä¸‹ç»„ä»¶çš„æ¸²æŸ“æµç¨‹<br/>
1. ç‚¹å‡» changeShow æŒ‰é’®, show æ•°æ®å‘ç”Ÿæ”¹å˜, Fatherç»„ä»¶é‡æ–°æ¸²æŸ“
2. ç”±äº Father ç»„ä»¶é‡æ–°æ¸²æŸ“, å‡½æ•° increment1 å’Œ increment2 ä¹Ÿä¼šè¢«é‡æ–°èµ‹å€¼,æ‰€ä»¥ä¼ å…¥ SonBtn çš„ increment éƒ½ä¼šå‘ç”Ÿæ”¹å˜
3. å› ä¸º memo å¯¹æ•°æ®è¿›è¡Œæµ…å±‚æ¬¡çš„æ¯”è¾ƒåå‘ç° increment å·²ç»æ”¹å˜æ‰€ä»¥ SonBtn ç»„ä»¶éƒ½ä¼šé‡æ–°æ¸²æŸ“<br/><br/>
æ‰€ä»¥æ§åˆ¶å°ä¼šæ‰“å°å‡º `SonBtnå­ç»„ä»¶è¢«æ‰§è¡Œincremnet1` `SonBtnå­ç»„ä»¶è¢«æ‰§è¡Œincremnet2`<br/>
è¿™æ—¶å€™é—®é¢˜å°±æ¥äº†,æˆ‘ä»¬ä¸å¸Œæœ›æ”¹å˜ `show` çš„æƒ…å†µä¸‹å¯¹ `Father` ç»„ä»¶ä¸­çš„ `increment` å‡½æ•°è¿›è¡Œé‡æ–°èµ‹å€¼ è¿›è€Œå¯¼è‡´ä¾èµ– `increment` å‡½æ•°çš„ `SonButton` ç»„ä»¶é‡æ–°æ¸²æŸ“, è¿™æ—¶å€™ `useCallback` å°±ç™»åœºäº†
### useCallback
- useCallback ä¼šè¿”å›ä¸€ä¸ªå‡½æ•°çš„ memoized (è®°å¿†çš„)å€¼
- åœ¨ä¾èµ–ä¸å˜çš„æƒ…å†µä¸‹,å¤šæ¬¡å®šä¹‰çš„æ—¶å€™ï¼Œè¿”å›çš„å€¼æ˜¯ç›¸åŒçš„<br/>
æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ `increment2`ä»£ç :
```js
const increment2 = useCallback(() => {
    console.log('æ‰§è¡Œincrement2å‡½æ•°')
    setcount(count + 1)
}, [count])
```
ä½¿ç”¨ `useCallback` å¯¹å‡½æ•°è¿›è¡ŒåŒ…è£¹å,ç‚¹å‡» changeShowæŒ‰é’®,æŸ¥çœ‹æ§åˆ¶å°,å‘ç°åªæ‰“å°å‡ºäº†`SonBtnå­ç»„ä»¶è¢«æ‰§è¡Œincremnet1`<br/>
è¿›è€Œæˆ‘ä»¬çš„ä¼˜åŒ–ä»»åŠ¡å°±å®Œæˆäº†
## æ€§èƒ½ä¼˜åŒ–-Hooks:useMemo
è¯ä¸å¤šè¯´,è¿˜æ˜¯çœ‹ä¸‹åˆ—ä»£ç 
```js
function caculateNum(num) {
    console.log('å‡½æ•°é‡æ–°æ‰§è¡Œ');
    let total = 0
    for (let i = 1; i < num; i++) {
        total += i;
    }
    return total
}

export default function MemoHookDemo() {
    const [count, setcount] = useState(10)
    const [show, setshow] = useState(true)
    
    const total = caculateNum(count)
    return (
        <div>
            <h2>è®¡ç®—æ•°å­—çš„å’Œ{total}</h2>
            <button onClick={e => { setcount(count + 1) }}>count + 1</button>
            <button onClick={e => { setshow(!show) }}>åˆ‡æ¢</button>
        </div>
    )
}
```
æ‰§è¡Œä¸Šè¿°ä»£ç ,æ— è®ºæˆ‘ä»¬ç‚¹å‡»äº†æ˜¯ +1è¿˜æ˜¯ åˆ‡æ¢ ä¸Šé¢çš„æ¡ˆä¾‹éƒ½ä¼šé‡æ–°è®¡ç®—ä¸€æ¬¡,äº‹å®ä¸Šï¼Œæˆ‘ä»¬åªæ˜¯å¸Œæœ›åœ¨ `count` å‘ç”Ÿå˜åŒ–æ—¶é‡æ–°è®¡ç®—<br/>
è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `useMemo` æ¥è¿›è¡Œæ€§èƒ½çš„ä¼˜åŒ–:
```js
function caculateNum(num) {
    console.log('å‡½æ•°é‡æ–°æ‰§è¡Œ');
    let total = 0
    for (let i = 1; i < num; i++) {
        total += i;
    }
    return total
}
export default function MemoHookDemo01() {
    const [count, setcount] = useState(10)
    const [show, setshow] = useState(true)
    // ä½¿ç”¨ useMemo åšæ€§èƒ½ä¼˜åŒ– (åˆ‡æ¢ show æ—¶ä¸ä¼šæ‰§è¡Œ caculateNumå‡½æ•°äº†)
    const total = useMemo(() => caculateNum(count), [count])
    return (
        <div>
            <h2>è®¡ç®—æ•°å­—çš„å’Œ{total}</h2>
            <button onClick={e => { setcount(count + 1) }}>count + 1</button>
            <button onClick={e => { setshow(!show) }}>åˆ‡æ¢</button>
        </div>
    )
}
```
è¿™æ˜¯åç‚¹å‡» åˆ‡æ¢æŒ‰é’® æ§åˆ¶å°å¹¶ä¸ä¼šæ‰“å°å‡º `å‡½æ•°é‡æ–°æ‰§è¡Œ` ä¹Ÿå°±æ˜¯è¯´ä¸ä¼šå†é‡å¤è®¡ç®—äº†<br/>
å†æ¥çœ‹ä¸‹é¢åœºæ™¯
```js
const SonInfo = memo((
    props) => {
        console.log('SonInfoé‡æ–°æ¸²æŸ“');
        return <h2>åå­—:{props.info.name} å¹´é¾„:{props.info.age}</h2>
    })

export default function Father() {
    const [show, setshow] = useState(true)
    const info = { name: 'å¼ ä¸‰', age: 18 }
    return (
        <div>
            <SonInfo info={info} />
            <button onClick={e => { setshow(!show) }}>åˆ‡æ¢</button>
        </div>
    )
}
```
ç‚¹å‡»åˆ‡æ¢æŒ‰é’®, æ§åˆ¶å°æ‰“å°å‡º `SonInfoé‡æ–°æ¸²æŸ“`,å› ä¸º `show` æ•°æ®å‘ç”Ÿæ”¹å˜, `Father` ç»„ä»¶é‡æ–°æ¸²æŸ“, `info` é‡æ–°èµ‹å€¼,ä¼ å…¥ `SonInfoç»„ä»¶` ä¸­è¿›è¡Œæµ…å±‚æ¬¡æ¯”è¾ƒ, ç”±äºä¸¤ä¸ª `info` æ˜¯ä¸åŒçš„å¼•ç”¨,æ‰€ä»¥å‘ç”Ÿæµ…å±‚æ¬¡æ¯”è¾ƒæ—¶é‡æ–°æ¸²æŸ“<br/>
æœ‰ä¸¤ä¸ªæ–¹æ³•å¯ä»¥è§£å†³ `SonInfoç»„ä»¶`çš„ä¸å¿…è¦æ¸²æŸ“<br/>
- è§£å†³æ–¹æ¡ˆä¸€:å°† `const info` å£°æ˜æ–¹å¼æ”¹ä¸º `useState` å°±ä¸ä¼šé‡æ–°æ¸²æŸ“ `SonInfo`ç»„ä»¶
- è§£å†³æ–¹æ¡ˆäºŒ:ä½¿ç”¨ `useMemo`<br/>
ä¸‹é¢æ¼”ç»ƒä¸€ä¸‹è§£å†³æ–¹æ¡ˆäºŒ
```js
const SonInfo = memo(
    (props) => {
        console.log('SonInfoé‡æ–°æ¸²æŸ“');
        return <h2>åå­—:{props.info.name} å¹´é¾„:{props.info.age}</h2>
    }
)
export default function Father() {
    console.log('MemoHookDemo2é‡æ–°æ¸²æŸ“');
    const [show, setshow] = useState(true)

    const info = useMemo(() => ({ name: 'å¼ ä¸‰', age: 18 }), [])
    return (
        <div>
            <SonInfo info={info} />
            <button onClick={e => { setshow(!show) }}>åˆ‡æ¢</button>
        </div>
    )
}
```
è¿™æ—¶å€™å¯¹è±¡ä½œä¸º `useMemo` å›è°ƒå‡½æ•°çš„è¿”å›å€¼,ä¾èµ–ä¸º `[]`,ä¹Ÿå°±æ˜¯è¯´æ— è®ºæ€æ ·`info`éƒ½ä¸ºç›¸åŒçš„å¼•ç”¨,æ‰€ä»¥å°±ä¸ä¼šå¯¹ `SonInfoç»„ä»¶` è¿›è¡Œä¸å¿…è¦çš„æ¸²æŸ“äº†
### useCallback å’Œ useMemo çš„åŒºåˆ«
ä¸Šé¢çš„æ¡ˆä¾‹æ„Ÿè§‰åˆ° `useCallback` å’Œ `useMemo` éå¸¸çš„ç›¸ä¼¼,ä½†ç”¨ä¸€å¥è¯æ¥æ€»ç»“ä»–ä»¬çš„åŒºåˆ«å°±æ˜¯<br/>
**useCallbackæ˜¯å¯¹å‡½æ•°è¿›è¡Œä¼˜åŒ–, useMemoæ˜¯å¯¹å‡½æ•°çš„è¿”å›å€¼è¿›è¡Œä¼˜åŒ–**<br/>
ä¹Ÿå°±æ˜¯è¯´ useCallback æ¡ˆä¾‹çš„ `useCallback` ä»£ç å¯ä»¥ç”¨ `useMemo` æ¥æ›¿æ¢
```js
const increment2 = useCallback(() => {
    console.log('æ‰§è¡Œincrement2å‡½æ•°')
    setcount(count + 1)
}, [count])

// æ›¿æ¢æˆ

const increment2 = useMemo(() => {
    return () => {
     console.log('æ‰§è¡Œincrement2å‡½æ•°')
     setcount(count + 1)
    }
}, [count])
```

